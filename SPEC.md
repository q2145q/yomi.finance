# Техническая спецификация: Система управления финансами кинопроизводства
**Версия:** 1.0  
**Дата:** Февраль 2026  
**Статус:** MVP — работающее веб-приложение с тестовыми данными

---

## 1. Executive Summary

Система управления финансами кинопроизводства — внутренний веб-инструмент для продюсерской команды, обеспечивающий полный цикл финансового контроля проекта: от бюджетирования до закрытия платежей. Включает интеграцию с Telegram-ботом для сбора отчётов от исполнителей и AI-обработку входящих данных.

**Первичная аудитория:** продакшн-компания с проектами бюджетом от 1,5 млрд рублей.  
**Перспектива:** масштабирование на рынок как SaaS-продукт.

---

## 2. Цели и метрики успеха

### Цели
- Заменить Google Sheets единой системой с контролем доступа
- Автоматизировать сбор производственных отчётов через TG-бот
- Обеспечить сквозной трекинг от бюджета до закрытого платежа
- Исключить ручные ошибки при расчёте налогов и кэшфлоу

### Метрики успеха MVP
- Все 6 модулей работают с тестовыми данными
- Расчёт налогов всех типов корректен на 100%
- TG-бот принимает сообщения и AI корректно распознаёт >80% стандартных отчётов
- Экселевидная навигация в бюджете работает (стрелки, Enter, Tab)

---

## 3. Scope

### Входит в MVP
- Модуль Бюджет
- Модуль Производственный отчёт
- Модуль Заявки на оплату
- Модуль Табели
- Модуль Кэшфлоу
- Модуль Закрытие платежей
- Управление контрагентами и договорами
- Импорт КПП (xlsx)
- Telegram-бот с AI-обработкой
- Ролевая модель доступа

### Не входит в MVP
- Офлайн-режим
- Мобильное приложение
- Интеграция с банк-клиентом
- Мультиязычность (только русский)
- Автоматическая отправка в бухгалтерию (только выгрузка файла)

---

## 4. Пользователи и роли

### Роли и права

| Роль | Бюджет | Лимит | Произв. отчёт | Заявки на оплату | Договоры | Контрагенты | Кэшфлоу | Платёжки |
|------|--------|-------|---------------|------------------|----------|-------------|---------|---------|
| Продюсер | RW + утверждение | RW | R | Утверждение | RW | RW | RW | R |
| Линейный продюсер | RW | R | RW | Утверждение | RW | RW | RW | R |
| Директор | R | R | RW (свои смены) | R | R | R | R | R |
| Ассистент продюсера | R | R | RW (актёры + загрузка) | R | R | R | R | RW (загрузка) |
| Делопроизводитель | R | R | R | R | R | R | R | R |

**Правила:**
- Лимит может изменять **только Продюсер**
- Заявку на оплату утверждают Продюсер **или** Линейный продюсер
- Один пользователь может быть привязан к нескольким проектам
- Каждый проект имеет свою изолированную команду

---

## 5. Структура данных

### 5.1 Проект

```
Project {
  id: UUID
  name: string
  currency_primary: enum(RUB, USD, EUR, ...)
  currencies_allowed: array[Currency]
  exchange_rate_mode: enum(CBR_ON_DATE, FIXED)
  exchange_rate_fixed: float | null
  status: enum(PREP, PRODUCTION, POST, CLOSED)
  created_at: datetime
  team: array[ProjectUser]
}
```

### 5.2 Контрагент

```
Contractor {
  id: UUID
  full_name: string
  passport_data: string (encrypted)
  type: enum(FL, SZ, IP, OOO)
  inn: string
  bank_details: string (encrypted)
  telegram_id: string | null
  phone: string
  email: string
  tax_scheme: TaxScheme
  currency: Currency
  projects: array[Project]
}
```

### 5.3 Налоговая схема

```
TaxScheme {
  id: UUID
  name: string  // "СЗ 6%", "ФЛ НДФЛ+Страховые", "НДС 20%"
  taxes: array[TaxComponent]
}

TaxComponent {
  name: string         // "НПД", "НДФЛ", "Страховые", "НДС"
  rate: float          // 0.06, 0.13, 0.30, 0.20
  type: enum(INTERNAL, EXTERNAL)
  recipient: enum(CONTRACTOR, BUDGET)  // для ФЛ налоги идут в бюджет, не контрагенту
}
```

**Формулы расчёта:**

- **INTERNAL (кроме ФЛ):** `gross = rate / (1 - tax_rate) * (1 - налог)`  
  Пример СЗ 6%: `gross = 100 + (100 / (100-6) * 6) = 106.38`
- **EXTERNAL:** `gross = rate * (1 + tax_rate)`  
  Пример НДС 20%: `gross = 100 + 100*0.20 = 120`
- **ФЛ (комбо):** НДФЛ — internal в бюджет, Страховые — external в бюджет. Контрагент получает чистые 100р.
- **Комбо ИП+НДС:** применяется последовательно

**Правило автоподтягивания налога:** при создании строки бюджета/договора — налог подтягивается из карточки контрагента автоматически. Изменение возможно только ручным специальным действием (с отметкой "ручное изменение").

### 5.4 Договор

```
Contract {
  id: UUID
  number: string
  project_id: UUID
  contractor_id: UUID
  payment_type: enum(SALARY, PER_SHIFT, PERIODIC)
  payment_period: string | null  // "weekly", "monthly", custom
  currency: Currency
  budget_lines: array[ContractBudgetLine]  // привязка к статьям бюджета
  status: enum(DRAFT, ACTIVE, CLOSED)
  signed_at: date
  valid_from: date
  valid_to: date
  tax_scheme_id: UUID
  tax_override: boolean  // флаг ручного изменения налога
}
```

### 5.5 Бюджет — структура статей

```
BudgetLine {
  id: UUID
  project_id: UUID
  parent_id: UUID | null       // для вложенности (неограниченная глубина)
  level: int                   // вычисляемый
  code: string                 // "1.2.3.1"
  name: string
  type: enum(GROUP, ITEM, SPREAD_ITEM)  // GROUP=группа, ITEM=статья, SPREAD_ITEM=расписная
  unit: string                 // "день", "час", "км", "шт"
  quantity_units: float        // кол-во единиц измерения
  rate: float                  // ставка
  quantity: float              // кол-во
  tax_scheme_id: UUID
  tax_override: boolean
  currency: Currency
  
  // Вычисляемые поля
  subtotal: float              // rate * quantity
  tax_amount: float
  total: float                 // итого с налогом
  
  // Финансовые состояния
  limit: float                 // утверждённый лимит (только продюсер)
  accrued: float               // начислено из производственных отчётов
  paid: float                  // оплачено из платёжек
  closed: float                // закрыто по документам
  advance: float               // аванс (когда paid > accrued)
  
  // Связи
  contract_ids: array[UUID]    // привязка к договорам (для расписных — несколько)
  correlated_lines: array[UUID] // для ставка/переработка/километраж — одна группа
}
```

**⚠️ Правило корреляции:** статьи "ставка", "переработка", "километраж" внутри одного договора **обязательно** привязываются к одному договору и не могут существовать раздельно.

**⚠️ Расписная статья:** может быть распределена между несколькими договорами. Сумма долей = 100% от статьи.

### 5.6 Производственный отчёт

```
ProductionReport {
  id: UUID
  project_id: UUID
  shoot_day_number: int
  date: date
  kpp_scene_ids: array[string]  // привязка к сценам из КПП
  location: string
  shooting_group: string
  entries: array[ReportEntry]
  status: enum(DRAFT, SUBMITTED, APPROVED)
  created_by: UUID
}

ReportEntry {
  id: UUID
  report_id: UUID
  contractor_id: UUID
  budget_line_id: UUID
  contract_id: UUID
  source: enum(TG_BOT, MANUAL, ASSISTANT)
  raw_text: string | null      // оригинальный текст из TG-бота
  ai_parsed: boolean
  ai_confidence: float | null
  
  // Данные смены
  shift_start: time
  shift_end: time
  lunch_break_minutes: int
  gap_minutes: int             // разрыв
  overtime_hours: float        // вычисляется автоматически
  equipment: array[string]     // "Ронин", "Коптер" и тд
  
  // Финансы
  unit: string
  quantity: float
  rate: float
  tax_scheme_id: UUID
  amount_net: float
  amount_gross: float
  
  status: enum(PENDING, APPROVED, IN_PAYMENT, PAID)
  payment_id: UUID | null
}
```

### 5.7 Табель

Табель — это **представление** (view) всех ReportEntry по конкретному договору, сгруппированных по сменам.

```
Timesheet {
  contract_id: UUID
  entries: array[ReportEntry]  // фильтруется по contract_id
  
  // Агрегаты
  total_shifts: int
  total_amount_gross: float
  total_paid: float
  total_pending: float
}
```

### 5.8 Заявка на оплату

```
PaymentRequest {
  id: UUID
  payment_id: string           // уникальный числовой ID формата "123-456-789"
  project_id: UUID
  source: enum(SALARY, TIMESHEET, INVOICE)
  
  contractor_id: UUID
  contract_id: UUID | null     // обязателен если сумма > 100 000 руб
  
  amount: float
  currency: Currency
  advance_amount: float        // если аванс
  status: enum(DRAFT, SUBMITTED, APPROVED, PAID, CLOSED)
  
  // Для табельных выплат
  report_entry_ids: array[UUID]
  
  // Для счетов
  invoice_file_url: string | null
  invoice_number: string | null
  
  created_at: datetime
  approved_by: UUID | null
  approved_at: datetime | null
}
```

**⚠️ Правило счетов:** если сумма по контрагенту < 100 000 руб — договор не обязателен. Если ≥ 100 000 руб (единоразово или совокупно) — привязка к договору обязательна.

### 5.9 Платёж (закрытие)

```
Payment {
  id: UUID
  payment_id: string           // тот же уникальный ID
  payment_request_id: UUID
  
  amount_paid: float
  paid_at: date
  payment_doc_url: string      // платёжка от бухгалтерии
  payment_doc_type: enum(PDF, CSV)
  
  // Для СЗ
  receipt_url: string | null   // чек из "Мой налог"
  receipt_received: boolean
  
  status: enum(PARTIALLY_CLOSED, CLOSED)
  // CLOSED = платёжка + чек (для СЗ) получены
}
```

### 5.10 Кэшфлоу

```
CashflowItem {
  id: UUID
  project_id: UUID
  budget_line_id: UUID
  
  period_type: enum(WEEK, MONTH, CUSTOM)
  period_start: date
  period_end: date
  
  amount_planned: float
  amount_actual: float         // из оплаченных платежей
  
  source: enum(CONTRACT, AUTO_SALARY, AUTO_SHIFT, MANUAL)
  // AUTO_SALARY = из договора оклада
  // AUTO_SHIFT = из КПП по сменам
  // MANUAL = проставлено продюсером вручную
  
  created_by: UUID | null
}
```

### 5.11 КПП (импорт)

```
KPP {
  id: UUID
  project_id: UUID
  shooting_group: string       // "Съёмочная группа №1"
  file_url: string
  imported_at: datetime
  
  scenes: array[KPPScene]
}

KPPScene {
  id: UUID
  kpp_id: UUID
  scene_number: string
  date: date | null
  shift_number: int | null
  time_start: time | null
  time_end: time | null
  duration_planned: float      // хронометраж план (часы)
  location: string
  characters: array[string]
  extras: string | null
  horses_riders: string | null
  special_equipment: array[string]   // "Ронин", "Коптер", "Авторобот"
  sfx: string | null
  stunt: string | null
  notes: string | null
}
```

---

## 6. Функциональные требования

### 6.1 Модуль Бюджет

**Интерфейс:**
- Таблица с неограниченной вложенностью статей (expand/collapse групп)
- Навигация: стрелки ↑↓←→, Enter для редактирования, Tab для перехода между ячейками, Escape для отмены
- Фиксированные столбцы: Статья / Ед. изм / Кол-во ед. изм / Ставка / Кол-во / Итого / Налог / Итого налог / Итого
- Дополнительные столбцы (переключаемые): Лимит / Начислено / Оплачено / Закрыто / Аванс
- Формулы защищены от ручного изменения (только через поля ввода)
- Мультивалютность: каждая строка может иметь свою валюту, итоги конвертируются в основную валюту проекта

**Логика:**
- Шаблон бюджета загружается при создании проекта, затем редактируется
- Добавление новых статей/групп в любом месте иерархии
- Расписная статья: при создании указываются доли по договорам (в % или суммах), сумма долей контролируется на = 100%
- При превышении записи в производственном отчёте >80% от базовой ставки за смену → система предлагает добавить новую статью в бюджет и договор
- Итоги групп вычисляются автоматически снизу вверх

### 6.2 Модуль Контрагенты и Договоры

**Карточка контрагента:**
- Все поля из раздела 5.2
- Привязка TG ID → при первом обращении бота с проект-ID система предлагает подтверждение привязки
- История договоров по всем проектам

**Договор:**
- Привязка к статьям бюджета (с выбором конкретных строк)
- Для типа "посменно": обязательное наличие связанных статей ставка+переработка+километраж
- Налог подтягивается из карточки контрагента; ручное изменение = флаг + причина

### 6.3 Модуль Производственный отчёт

**Интерфейс:**
- Главная таблица: строки = статьи бюджета, столбцы = съёмочные дни
- Ячейка показывает: сумму начисленного за день по этой статье
- Фильтры: по дате, по договору, по контрагенту, по статусу, по статье
- Клик на ячейку → детальное раскрытие записей

**Добавление записи (вручную — директор/ассистент):**
1. Выбор съёмочного дня
2. Выбор контрагента (из списка проекта)
3. Выбор статьи бюджета (автоматически предлагается из договора контрагента)
4. Ввод данных смены
5. Система автоматически считает: переработку, сумму, налог

**Добавление записи через TG-бот:**
- AI парсит свободный текст → предлагает распознанные данные
- Директор/ассистент видят входящие записи из бота в очереди на проверку
- Статус: PENDING → APPROVED

**Неизвестный расход:**
- Если исполнитель сообщает о расходе без статьи в договоре
- AI предлагает варианты: к какой существующей статье отнести (например, "мойка машины" → "2 часа переработки")
- Если сумма >80% базовой ставки → принудительное предложение создать новую статью

### 6.4 Модуль Табели

**Интерфейс:**
- Список всех смен по договору
- Столбцы: Дата / Смена / Часы / Переработка / Сумма нетто / Сумма брутто / Статус / ID оплаты
- Фильтры: оплачено / подано в заявку / не оплачено
- Мультивыбор строк → кнопка "Подать в заявку"
  - Автоматически считается итоговая сумма
  - Создаётся PaymentRequest с уникальным payment_id
  - В табеле проставляется payment_id + статус "Передано в заявку"

### 6.5 Модуль Заявки на оплату

**Источники:**
1. **Оклад/периодические** — создаются автоматически по расписанию из договора
2. **Посменные** — из табеля (см. 6.4)
3. **Счета** — ручная загрузка PDF/CSV, парсинг реквизитов

**Интерфейс:**
- Список заявок с фильтрами по статусу, проекту, контрагенту, периоду
- Детальный просмотр: состав позиций, contract_id, payment_id
- Кнопки: Утвердить / Отклонить (доступно Продюсеру и Линейному продюсеру)
- Экспорт утверждённых заявок для бухгалтерии (PDF/XLSX)

**Уникальный payment_id:** генерируется автоматически при создании заявки, формат `XXX-XXX-XXX` (числовой, случайный, уникальный в рамках системы).

### 6.6 Модуль Закрытие платежей

**Загрузка платёжки:**
- Ассистент загружает PDF или CSV от бухгалтерии
- Система парсит: сумму, дату, получателя, назначение платежа
- Матчинг по payment_id из назначения платежа → автоматическое закрытие позиций
- Ручное сопоставление если автоматический матчинг не сработал

**Для СЗ:**
- После загрузки платёжки статус = "Ожидает чек"
- Загрузка чека: ассистент или исполнитель через TG-бот (фото/PDF)
- После чека статус = CLOSED

**Аванс:**
- Если paid > accrued → статус статьи = "Аванс", отображается отдельно
- Система не блокирует авансовый платёж, только маркирует

### 6.7 Модуль Кэшфлоу

**Интерфейс:**
- Таблица: строки = статьи бюджета (с группировкой), столбцы = периоды (недели или месяцы)
- Переключатель периода: неделя / месяц
- Каждая ячейка: плановая сумма (редактируемая) + фактическая (из платежей)
- Цветовая индикация: превышение плана / в норме / недовыплата

**Автоматическое распределение:**
- **Оклад:** сумма договора делится на количество месяцев периода
- **Посменные:** берётся КПП → считаются смены по неделям/месяцам → применяются правила оплаты из договора (раз в неделю, раз в месяц)
- **Ручное:** продюсер проставляет суммы вручную (переопределяет авто)

---

## 7. Telegram-бот

### 7.1 Сценарии использования

**Регистрация исполнителя:**
1. Продюсер привлекает контрагента к проекту → система генерирует project_id
2. Контрагент пишет боту: `/start [project_id]`
3. Бот запрашивает подтверждение ФИО
4. TG ID привязывается к карточке контрагента

**Отчёт за смену:**
```
Пример сообщения: "смена с 8 до 23 + обед, + разрыв 2 + ронин"

AI парсит:
- shift_start: 08:00
- shift_end: 23:00
- lunch_break: 60 мин (стандарт)
- gap: 2 часа
- equipment: ["Ронин"]
- рабочее время: 15ч - 1ч обед - 2ч разрыв = 12ч
- базовая смена: 12ч (или из договора)
- переработка: вычисляется по договору
```

**Загрузка чека СЗ:**
- Исполнитель отправляет фото или PDF чека
- Бот привязывает к последнему незакрытому платежу
- Уведомление ассистенту на проверку

**Запрос справки:**
- `/spravka` → бот запрашивает тип справки, формирует задачу для ассистента

### 7.2 AI-обработка

**Модель:** Anthropic Claude API (claude-sonnet)

**Промпт-контекст для AI включает:**
- Данные договора контрагента (ставка, тип оплаты, нормы смены)
- Список статей бюджета проекта
- Исторические записи контрагента (для обучения на его паттернах)

**Выход AI:**
```json
{
  "shift_start": "08:00",
  "shift_end": "23:00",
  "lunch_break_minutes": 60,
  "gap_minutes": 120,
  "equipment": ["Ронин"],
  "overtime_hours": 2.5,
  "suggested_budget_line_id": "uuid",
  "confidence": 0.92,
  "notes": "Распознан ронин как операторская техника"
}
```

**Если confidence < 0.7** → запись попадает в очередь с флагом "требует проверки" + уведомление директору/ассистенту.

---

## 8. Импорт КПП

**Процесс:**
1. Пользователь загружает xlsx файл КПП
2. Система парсит листы (каждый лист = одна съёмочная группа)
3. Извлекаются: дата, номер смены, время, локация, персонажи, массовка, спецоборудование
4. Создаются KPPScene записи
5. Система предлагает матчинг: персонаж/категория → статья бюджета (можно подтвердить или изменить)
6. После подтверждения — KPP используется как основа для кэшфлоу и производственных отчётов

**Формат КПП (по образцу):**
- Колонка T = временной диапазон
- Колонка "Хр-ж план" = хронометраж
- Колонка "Персонажи" = актёры
- Колонка "Массовка / Групповка" = массовка
- Колонка "Операторская техника / Спец. оборудование" = оборудование

---

## 9. Интеграции

| Интеграция | Назначение | Направление | Формат |
|-----------|-----------|-------------|--------|
| Telegram Bot API | Сбор отчётов исполнителей | Входящий | Webhook |
| Anthropic Claude API | Парсинг свободного текста | Исходящий | REST |
| КПП (xlsx) | Импорт плана съёмок | Входящий | Файл |
| Платёжки бухгалтерии | Закрытие платежей | Входящий | PDF/CSV |
| Счета контрагентов | Заявки на оплату | Входящий | PDF/CSV |
| ЦБ РФ API (опционально) | Курсы валют | Исходящий | REST |

---

## 10. Автоматизации и триггеры

| Триггер | Действие |
|---------|---------|
| Создание договора с типом SALARY | Создание записей в Кэшфлоу с авторазбивкой по месяцам |
| Загрузка КПП | Предложение матчинга сцен → статьи бюджета |
| Сообщение в TG-боте | AI-парсинг → создание ReportEntry со статусом PENDING |
| Выделение смен в табеле + "Подать в заявку" | Создание PaymentRequest + простановка payment_id в табеле |
| Загрузка платёжки | Парсинг + матчинг по payment_id + обновление статусов |
| Загрузка чека СЗ | Обновление статуса платежа → CLOSED |
| ReportEntry сумма >80% базовой ставки | Предупреждение + предложение добавить статью в бюджет |
| Дата выплаты по договору (оклад) | Автосоздание PaymentRequest |
| Платёж совокупно > 100к без договора | Блокировка + требование привязать договор |

---

## 11. Edge Cases и обработка ошибок

| Ситуация | Обработка |
|---------|---------|
| Исполнитель пишет в бот без регистрации | Бот запрашивает project_id, предлагает регистрацию |
| AI не распознал сообщение (confidence < 0.7) | Флаг "требует проверки", уведомление директору |
| Расход не соответствует ни одной статье договора | AI предлагает варианты, финальное решение — директор/ассистент |
| Оплачено > начислено (аванс) | Статус "Аванс", остаток отображается отдельно, не блокирует |
| Несколько групп в КПП | Каждый лист xlsx = отдельная группа, финансово — единый бюджет |
| Платёжка без payment_id в назначении | Ручной матчинг ассистентом |
| Чек СЗ не загружен в течение 7 дней | Уведомление ассистенту |
| Сумма счёта совокупно превышает 100к | Блокировка заявки + требование договора |
| Расписная статья: доли не равны 100% | Блокировка сохранения + ошибка |
| Удаление контрагента с активными договорами | Запрет + показ связанных объектов |
| Валютный контракт: курс не задан | Требование указать курс или выбрать режим ЦБ |

---

## 12. Нефункциональные требования

### Производительность
- Загрузка страницы бюджета с 500+ строками: < 2 сек
- Ответ TG-бота: < 3 сек
- AI-парсинг: < 5 сек

### Безопасность
- Паспортные данные и банковские реквизиты: хранение в зашифрованном виде (AES-256)
- HTTPS everywhere
- Аутентификация: email + пароль + 2FA (опционально)
- Сессии с таймаутом

### Доступ
- Ролевая модель: каждый запрос проверяет права на уровне API
- Изоляция проектов: пользователь видит только свои проекты

### Логирование
- Все изменения финансовых данных логируются: кто, что, когда, старое значение → новое
- Лог доступен Продюсеру и Линейному продюсеру

### Хостинг
- Без ограничений по географии
- Резервное копирование: ежедневно

---

## 13. Риски и допущения

| # | Тип | Описание | Митигация |
|---|-----|---------|----------|
| 1 | ⚠️ Риск | AI неправильно парсит нестандартные сообщения | Очередь проверки, confidence threshold |
| 2 | ⚠️ Риск | Структура КПП может отличаться от шаблона | Гибкий парсер + ручная корректировка маппинга |
| 3 | ⚠️ Допущение | Курс валют по ЦБ РФ достаточен для международных проектов | Добавить возможность фиксированного курса |
| 4 | ⚠️ Риск | Исполнители не будут пользоваться ботом | UX бота должен быть максимально простым |
| 5 | ⚠️ Допущение | Бухгалтерия предоставляет платёжки в PDF или CSV | Уточнить реальный формат выгрузки банка |
| 6 | ✅ Закрыт | Таймаут чека СЗ = 7 дней | — |
| 7 | ✅ Закрыт | 152-ФЗ — вне скоупа MVP | — |

---

## 14. Роадмап доставки

### MVP (работающее веб-приложение с тестовыми данными)

**Этап 1 — Ядро (4-6 недель)**
- Авторизация и ролевая модель
- Управление проектами и контрагентами
- Модуль Бюджет (экселевидный интерфейс, налоги, вложенность)
- Шаблон бюджета

**Этап 2 — Производство (3-4 недели)**
- Импорт КПП
- Договоры
- Производственный отчёт (ручной ввод)
- Табели

**Этап 3 — Финансы (3-4 недели)**
- Заявки на оплату (все 3 источника)
- Загрузка платёжек и закрытие
- Кэшфлоу

**Этап 4 — Автоматизация (2-3 недели)**
- Telegram-бот
- AI-парсинг (Claude API)
- Уведомления и триггеры

**Итого MVP: ~12-17 недель**

---

*Документ готов к передаче в разработку. Следующий шаг: декомпозиция на задачи и выбор технического стека.*

---

## 15. Инструкции для Claude Code

### Общие правила работы

**Ты — разработчик проекта yomi.finance. Следуй этим правилам на протяжении всей разработки.**

---

### Репозиторий и деплой

- **GitHub:** `https://github.com/q2145q/yomi.finance.git`
- **Продакшн домен:** `https://finance.yomimovie.art`
- После каждого значимого изменения — коммит в GitHub с понятным сообщением на русском
- После каждого этапа — деплой на `finance.yomimovie.art` для тестирования продюсером

**Формат коммитов:**
```
[модуль] краткое описание изменения
Пример: [бюджет] добавлена навигация стрелками и Tab
```

---

### Структура проекта (обязательные файлы)

```
/
├── SPEC.md              ← главная спецификация (этот документ)
├── PLAN.md              ← детальный план разработки с чекбоксами
├── PROGRESS.md          ← текущий статус: что сделано, что в работе
├── NEXT_STEPS.md        ← следующие 3-5 конкретных шагов
├── DECISIONS.md         ← лог всех архитектурных решений и обсуждений
├── CHANGELOG.md         ← история изменений по версиям
└── docs/
    ├── data-model.md    ← актуальная схема данных
    ├── api.md           ← документация API эндпоинтов
    └── deploy.md        ← инструкция по деплою
```

---

### PLAN.md — формат

```markdown
# План разработки yomi.finance

## Этап 1 — Ядро
- [ ] Авторизация и ролевая модель
- [ ] Управление проектами
- [ ] Управление контрагентами
- [ ] Модуль Бюджет — структура и вложенность
- [ ] Модуль Бюджет — налоговые схемы
- [ ] Модуль Бюджет — экселевидный интерфейс
- [ ] Шаблон бюджета

## Этап 2 — Производство
...
```

Чекбоксы обновляются по мере выполнения.

---

### PROGRESS.md — формат

```markdown
# Статус разработки
Обновлено: [дата]

## Сейчас в работе
- [задача]

## Завершено
- [дата] [задача]

## Заблокировано
- [задача] — причина
```

---

### NEXT_STEPS.md — формат

```markdown
# Следующие шаги
Обновлено: [дата]

1. [конкретная задача] — [оценка времени]
2. ...
```

Обновляется после каждой завершённой задачи.

---

### DECISIONS.md — лог решений и обсуждений

**Это критически важный файл.** Все решения принятые в процессе разработки и обсуждений с продюсером — записываются сюда.

```markdown
# Лог решений

## [дата] — [тема]
**Контекст:** что обсуждалось
**Решение:** что решили
**Причина:** почему именно так
**Влияние:** на что влияет

---
```

Примеры того что пишется в DECISIONS.md:
- Выбор технического стека и причины
- Изменения в логике (например, изменение формулы налога)
- Новые требования от продюсера
- Отказ от функции или перенос в следующий этап
- Любые договорённости из чата

---

### Правила обновления документации

1. **До начала задачи** — обнови NEXT_STEPS.md
2. **В процессе** — обнови PROGRESS.md ("сейчас в работе")
3. **После завершения** — обнови PLAN.md (чекбокс), PROGRESS.md, CHANGELOG.md
4. **При архитектурном решении** — запиши в DECISIONS.md
5. **При изменении данных или API** — обнови docs/data-model.md или docs/api.md
6. **Перед деплоем** — убедись что NEXT_STEPS.md актуален

---

### Деплой

- Каждый деплой на `finance.yomimovie.art` должен быть рабочим и не ломать предыдущий функционал
- После деплоя — сообщи продюсеру что именно можно потестировать и по какому URL
- Инструкция по деплою поддерживается актуальной в `docs/deploy.md`

---

### Стек (без жёстких ограничений, рекомендации)

Выбери стек исходя из задачи, задокументируй выбор в DECISIONS.md. Ориентиры:
- **Frontend:** React или Next.js (для экселевидного интерфейса — предпочтительно)
- **Backend:** Node.js / Python FastAPI
- **БД:** PostgreSQL
- **Деплой:** любой удобный (Railway, Vercel, VPS)
- **Бот:** python-telegram-bot или grammy (Node.js)

Язык кода: любой, **комментарии только на русском языке.**
